{% extends "base.html" %}
{% block content %}
<div class="conteudo-calculadora">
  <h2>ðŸ§® Calculadora Financeira</h2>
  <p>Simule valores de CartÃ£o Consignado e Aumento de Margem 2026.</p>

  <form id="form_simulacao" method="post" action="{{ url_for('gerar_pdf_simulacao') }}">

    <!-- HIDDENS PARA ENVIAR RESULTADOS PARA O PDF -->
    <input type="hidden" name="tipo" id="tipo_field">
    <input type="hidden" name="margem_cartao" id="margem_cartao">
    <input type="hidden" name="limite_cartao" id="limite_cartao">
    <input type="hidden" name="saque_cartao" id="saque_cartao">
    <input type="hidden" name="cartao_cartao" id="cartao_cartao">

    <input type="hidden" name="novo_salario" id="novo_salario">
    <input type="hidden" name="aumento_margem" id="aumento_margem">
    <input type="hidden" name="margem_nova" id="margem_nova">
    <input type="hidden" name="valor_liberado" id="valor_liberado">

    <!-- DADOS CLIENTE -->
    <div class="dados-cliente">
      <label>Nome do Cliente: *</label>
      <input type="text" id="nome_cliente" name="nome" required>

      <label>CPF: *</label>
      <input type="text" id="cpf_cliente" name="cpf" required>
    </div>

    <div class="cards-grid" style="display:flex; gap:20px; margin-top:16px;">

      <!-- CARTÃƒO -->
      <div class="card" style="flex:1; padding:12px; border:1px solid #ddd; border-radius:6px;">
        <h3>ðŸª™ CartÃ£o Consignado</h3>

        <label>SalÃ¡rio / Parcela (R$):</label>
        <input type="number" step="0.01" id="valor_pagamento_cartao" name="valor_pagamento">

        <label>Multiplicador:</label>
        <input type="number" step="0.01" id="multiplicador_cartao" name="multiplicador_cartao">

        <div style="margin-top:8px;">
          <button type="button" class="btn btn-warning" onclick="simularCartao()">ðŸ’¡ Simular CartÃ£o</button>
          <button type="button" class="btn btn-primary" onclick="submitPdf('cartao')">ðŸ“„ Gerar PDF CartÃ£o</button>
        </div>

        <div id="resultado_cartao" class="resultado" style="margin-top:10px; display:none; font-weight:bold;"></div>
      </div>

      <!-- AUMENTO 2026 -->
      <<div class="card" style="flex:1; padding:12px; border:1px solid #ddd; border-radius:6px;">
        <h3>ðŸ“ˆ Aumento de Margem 2026</h3>

        <label>SalÃ¡rio Atual:</label>
        <input type="number" step="0.01" id="salario_atual" name="salario_atual">

        <label>% de Aumento:</label>
        <input type="number" step="0.01" id="percentual_aumento" name="aumento_percent">

        <label>Multiplicador:</label>
        <input type="number" step="0.01" id="multiplicador_margem" name="multiplicador_margem">

        <label>Prazo (opcional):</label>
        <input type="text" id="prazo" name="prazo">

        <div style="margin-top:8px;">
          <button type="button" class="btn btn-warning" onclick="simularMargem()">ðŸ’¡ Simular Margem</button>
          <button type="button" class="btn btn-primary" onclick="submitPdf('margem')">ðŸ“„ Gerar PDF Margem</button>
        </div>

        <div id="resultado_margem" class="resultado" style="margin-top:10px; display:none; font-weight:bold;"></div>
      </div>

    </div>

    <div style="margin-top:18px;">
      <button type="button" class="btn btn-success" onclick="simularTudo()">ðŸš€ Simular Tudo</button>
      <button type="button" class="btn btn-danger" onclick="submitPdf('ambos')">ðŸ“„ Gerar PDF Total</button>
    </div>

  </form>
</div>

<script>
function formatBR(num){
  return Number(num).toFixed(2).toString().replace('.', ',');
}

function simularCartao(){
  const salario = parseFloat(document.getElementById("valor_pagamento_cartao").value)||0;
  const multi = parseFloat(document.getElementById("multiplicador_cartao").value)||0;

  const margem = salario * 0.05;
  const limite = margem * (multi || 1);
  const saque = limite * 0.7;
  const cartao = limite * 0.3;

  document.getElementById("resultado_cartao").innerHTML = `
    <div><b>Margem:</b> R$ ${formatBR(margem)}</div>
    <div><b>Limite:</b> R$ ${formatBR(limite)}</div>
    <div><b>Saque (70%):</b> R$ ${formatBR(saque)}</div>
    <div><b>CartÃ£o (30%):</b> R$ ${formatBR(cartao)}</div>
  `;
  document.getElementById("resultado_cartao").style.display="block";

  document.getElementById("margem_cartao").value = margem;
  document.getElementById("limite_cartao").value = limite;
  document.getElementById("saque_cartao").value = saque;
  document.getElementById("cartao_cartao").value = cartao;
}

function simularMargem(){
  const sal = parseFloat(document.getElementById("salario_atual").value)||0;
  const perc = parseFloat(document.getElementById("percentual_aumento").value)||0;
  const multi = parseFloat(document.getElementById("multiplicador_margem").value)||0;

  const novoSal = sal * (1 + perc/100);
  const aumento = novoSal - sal;
  const margem = aumento * 0.35;
  const valor = margem * (multi || 1);

  document.getElementById("resultado_margem").innerHTML = `
    <div><b>Novo SalÃ¡rio:</b> R$ ${formatBR(novoSal)}</div>
    <div><b>Aumento:</b> R$ ${formatBR(aumento)}</div>
    <div><b>Margem:</b> R$ ${formatBR(margem)}</div>
    <div><b>Valor Liberado:</b> R$ ${formatBR(valor)}</div>
  `;
  document.getElementById("resultado_margem").style.display="block";

  document.getElementById("novo_salario").value = novoSal;
  document.getElementById("aumento_margem").value = aumento;
  document.getElementById("margem_nova").value = margem;
  document.getElementById("valor_liberado").value = valor;
}

function simularTudo(){
  simularCartao();
  simularMargem();
}

function submitPdf(tipo){
  if(!document.getElementById("nome_cliente").value.trim() ||
     !document.getElementById("cpf_cliente").value.trim()){
    alert("Preencha Nome e CPF antes!");
    return;
  }
  document.getElementById("tipo_field").value = tipo;
  document.getElementById("form_simulacao").submit();
}
</script>
{% endblock %}

